<!-- pca/templates/pca_scatter.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDA Scatter Plot and 1D Histograms</title>
    <!-- Include Plotly.js for scatter plot -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Include Chart.js for histograms -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #f7f7f7;
        }

        .plot-container {
            width: 90%;
            margin: 20px auto;
        }

        .histograms-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 90%;
            margin: 20px auto;
        }

        .histogram-item {
            flex: 1;
            margin: 0 10px;
        }

        h1, h3 {
            text-align: center;
        }

        canvas {
            max-width: 100%;
        }

    </style>
</head>
<body>
    <h1>LDA of Iris Dataset</h1>

    <!-- Scatter Plot for LDA -->
    <div class="plot-container">
        <div id="scatter-plot" style="width: 100%; height: 300px;"></div>
    </div>

    <!-- Histograms Section -->
    <h1>LDA-Reduced Histograms for Iris Dataset</h1>

    <!-- Histograms placed horizontally -->
    <div class="histograms-container">
        <div class="histogram-item">
            <h3>Setosa</h3>
            <canvas id="setosa-histogram"></canvas>
        </div>
        <div class="histogram-item">
            <h3>Versicolor</h3>
            <canvas id="versicolor-histogram"></canvas>
        </div>
        <div class="histogram-item">
            <h3>Virginica</h3>
            <canvas id="virginica-histogram"></canvas>
        </div>
    </div>

    <script>
        // Fetch LDA data from Django backend
        async function fetchLdaData() {
            const response = await fetch('{% url "pca:scatter" %}');  // Update URL name if needed
            const data = await response.json();
            return data;
        }

        // Prepare LDA data for Plotly
        function preparePlotData(ldaData) {
            const speciesMap = {
                'setosa': 'blue',
                'versicolor': 'green',
                'virginica': 'red'
            };

            const plotData = {
                x: [],
                y: [],
                text: [],
                mode: 'markers',
                marker: { size: 12, color: [] },
            };

            ldaData.forEach(item => {
                plotData.x.push(item.LD1);  // Using LD1 (Linear Discriminant 1)
                plotData.y.push(item.LD2);  // Using LD2 (Linear Discriminant 2)
                plotData.text.push(item.species);
                plotData.marker.color.push(speciesMap[item.species]);
            });

            return [plotData];
        }

        // Draw LDA scatter plot
        async function drawScatterPlot() {
            const ldaData = await fetchLdaData();  // Fetch LDA data instead of PCA data
            const plotData = preparePlotData(ldaData);

            const layout = {
                title: 'LDA of Iris Dataset',  // Update the title for LDA
                xaxis: { title: 'Linear Discriminant 1' },
                yaxis: { title: 'Linear Discriminant 2' },
                showlegend: false
            };

            Plotly.newPlot('scatter-plot', plotData, layout);
        }

        // Fetch PCA-reduced histogram data from Django backend
        async function fetchPcaHistogramData() {
            const response = await fetch('{% url "pca:histogram" %}');
            const data = await response.json();
            return data;
        }

        // Bin data into 10 intervals
        function binData(data, numBins = 10) {
            const min = Math.min(...data);
            const max = Math.max(...data);
            const binSize = (max - min) / numBins;

            const bins = new Array(numBins).fill(0);
            data.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binSize), numBins - 1);
                bins[binIndex]++;
            });

            return bins;
        }

        // Function to create a 1D histogram (using Chart.js with bar chart type)
        function createHistogram(ctx, label, data, color) {
            const binnedData = binData(data, 10);  // Bin data into 10 intervals
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({ length: 10 }, (_, i) => `Bin ${i + 1}`), // Label bins
                    datasets: [{
                        label: label,
                        data: binnedData,
                        backgroundColor: color,
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true },
                        x: { display: true },  // Show x-axis labels (for bins)
                    },
                    plugins: {
                        legend: { display: true },
                    },
                }
            });
        }

        // Draw 1D histograms for each species using Chart.js
        async function drawHistograms() {
            const histData = await fetchPcaHistogramData();

            // Draw Setosa histogram
            const setosaCtx = document.getElementById('setosa-histogram').getContext('2d');
            createHistogram(setosaCtx, 'Setosa', histData['setosa'], 'blue');

            // Draw Versicolor histogram
            const versicolorCtx = document.getElementById('versicolor-histogram').getContext('2d');
            createHistogram(versicolorCtx, 'Versicolor', histData['versicolor'], 'green');

            // Draw Virginica histogram
            const virginicaCtx = document.getElementById('virginica-histogram').getContext('2d');
            createHistogram(virginicaCtx, 'Virginica', histData['virginica'], 'red');
        }

        // Run both scatter plot and histogram drawing functions on page load
        window.onload = async function() {
            await drawScatterPlot();
            await drawHistograms();
        };
    </script>
</body>
</html>

